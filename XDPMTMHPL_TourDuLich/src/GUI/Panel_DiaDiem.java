/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package GUI;

import BLL.DiaDiemBLL;
import DTO.DiaDiemDTO;
import java.awt.Color;
import java.awt.TrayIcon;
import java.util.ArrayList;
import java.util.HashMap;
import javax.swing.BorderFactory;
import javax.swing.JOptionPane;
import javax.swing.RowFilter;
import javax.swing.event.DocumentEvent;
import javax.swing.event.DocumentListener;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableModel;
import javax.swing.table.TableRowSorter;

/**
 *
 * @author Win 10
 */
public class Panel_DiaDiem extends javax.swing.JPanel {

    /**
     * Creates new form Panel_Gia
     */
    DefaultTableModel dtm;

    public Panel_DiaDiem() {
        initComponents();
        this.setBounds(0, 0, 786, 632);
        this.setBorder(BorderFactory.createLineBorder(Color.black));
        dtm = (DefaultTableModel) tblDiaDiem.getModel();
        showDiaDiem();
        TimKiem();
//        Test();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        jLabel7 = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        jLabel9 = new javax.swing.JLabel();
        txtTendd = new javax.swing.JTextField();
        jLabel12 = new javax.swing.JLabel();
        jScrollPane2 = new javax.swing.JScrollPane();
        tblDiaDiem = new javax.swing.JTable();
        jLabel14 = new javax.swing.JLabel();
        txtTimDD = new javax.swing.JTextField();
        btnThemDD = new javax.swing.JButton();
        btnXoaDD = new javax.swing.JButton();
        btnSuaDD = new javax.swing.JButton();
        jScrollPane4 = new javax.swing.JScrollPane();
        txtMoTa = new javax.swing.JTextPane();
        btnLamMoi = new javax.swing.JButton();
        cbTp = new javax.swing.JComboBox<>();
        cbMdd = new javax.swing.JComboBox<>();

        setPreferredSize(new java.awt.Dimension(786, 629));

        jLabel1.setFont(new java.awt.Font("Tahoma", 0, 36)); // NOI18N
        jLabel1.setText("Địa điểm");

        jLabel6.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jLabel6.setText("Mã địa điểm:");

        jLabel7.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jLabel7.setText("Tên địa điểm:");

        jLabel8.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jLabel8.setText("Thành phố:");

        jLabel9.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jLabel9.setText("Mô tả:");

        jLabel12.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N

        tblDiaDiem.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Mã địa điểm", "Tên địa điểm", "Thành phố", "Mô tả"
            }
        ));
        tblDiaDiem.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tblDiaDiemMouseClicked(evt);
            }
        });
        jScrollPane2.setViewportView(tblDiaDiem);

        jLabel14.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jLabel14.setText("Tìm kiếm:");

        btnThemDD.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        btnThemDD.setText("Thêm");
        btnThemDD.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnThemDDActionPerformed(evt);
            }
        });

        btnXoaDD.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        btnXoaDD.setText("Xóa");
        btnXoaDD.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnXoaDDActionPerformed(evt);
            }
        });

        btnSuaDD.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        btnSuaDD.setText("Sửa");
        btnSuaDD.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSuaDDActionPerformed(evt);
            }
        });

        jScrollPane4.setViewportView(txtMoTa);

        btnLamMoi.setFont(new java.awt.Font("Tahoma", 0, 12)); // NOI18N
        btnLamMoi.setText("Làm mới");
        btnLamMoi.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLamMoiActionPerformed(evt);
            }
        });

        cbTp.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Chọn Thành Phố", "An Giang", "Bà Rịa Vũng Tàu", "Bạc Liêu", "Bắc Kạn", "Bắc Giang", "Bắc Ninh", "Bến Tre", "Bình Dương", "Bình Định", "Bình Phước", "Bình Thuận", "Cà Mau", "Cao Bằng", "Cần Thơ – Hậu Giang", "TP. Đà Nẵng\t", "ĐắkLắk – Đắc Nông", "Đồng Nai", "Đồng Tháp", "Gia Lai", "Hà Giang", "Hà Nam", "TP. Hà Nội", "Hà Tây", "Hà Tĩnh", "Hải Dương", "TP. Hải Phòng", "Hoà Bình", "Hưng Yên", "TP. Hồ Chí Minh", "Khánh Hoà", "Kiên Giang", "Kon Tum", "Lai Châu – Điện Biên", "Lạng Sơn", "Lao Ca", "Lâm Đồng", "Long An", "Nam Định", "Nghệ An", "Ninh Bình", "Ninh Thuận", "Phú Thọ", "Phú Yên", "Quảng Bình", "Quảng Nam", "Quảng Ngãi", "Quảng Ninh", "Quảng Trị", "Sóc Trăng", "Sóc  Trăng", "Tây Ninh", "Thái Bình", "Thái Nguyên", "Thanh Hoá", "Thừa Thiên Huế", "Tiền Giang", "Trà Vinh", "Tuyên Quang", "Vĩnh Long", "Yên Bái" }));
        cbTp.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbTpActionPerformed(evt);
            }
        });

        cbMdd.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Chọn ZipCode", "94000", "74000", "99000", "17000", "21000", "16000", "83000", "72000", "53000", "77000", "62000", "96000", "22000", "92000", "59000", "55000", "71000", "93000", "54000", "29000", "30000", "10000", "31000", "43000", "34000", "35000", "13000", "39000", "70000", "57000", "95000", "58000", "28000", "20000", "19000", "61000", "81000", "32000", "42000", "40000", "63000", "24000", "56000", "45000", "51000", "52000", "36000", "46000", "97000", "27000", "73000", "33000", "23000", "41000", "47000", "82000", "90000", "25000", "91000", "11000", "26000" }));
        cbMdd.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbMddActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(253, 253, 253)
                        .addComponent(jLabel12)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(jLabel14)
                        .addGap(18, 18, 18)
                        .addComponent(txtTimDD, javax.swing.GroupLayout.PREFERRED_SIZE, 144, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addGap(318, 318, 318)
                                .addComponent(jLabel1))
                            .addGroup(layout.createSequentialGroup()
                                .addGap(245, 245, 245)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(layout.createSequentialGroup()
                                        .addComponent(jLabel9)
                                        .addGap(18, 18, 18)
                                        .addComponent(jScrollPane4, javax.swing.GroupLayout.PREFERRED_SIZE, 218, javax.swing.GroupLayout.PREFERRED_SIZE))
                                    .addGroup(layout.createSequentialGroup()
                                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                            .addComponent(jLabel7)
                                            .addComponent(jLabel6)
                                            .addComponent(jLabel8))
                                        .addGap(57, 57, 57)
                                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                            .addComponent(txtTendd, javax.swing.GroupLayout.DEFAULT_SIZE, 136, Short.MAX_VALUE)
                                            .addComponent(cbTp, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                            .addComponent(cbMdd, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))))))
                        .addGap(0, 256, Short.MAX_VALUE)))
                .addContainerGap())
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addGap(0, 0, Short.MAX_VALUE)
                .addComponent(btnThemDD, javax.swing.GroupLayout.PREFERRED_SIZE, 111, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(btnXoaDD, javax.swing.GroupLayout.PREFERRED_SIZE, 111, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(btnSuaDD, javax.swing.GroupLayout.PREFERRED_SIZE, 111, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(btnLamMoi, javax.swing.GroupLayout.PREFERRED_SIZE, 111, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(140, 140, 140))
            .addGroup(layout.createSequentialGroup()
                .addComponent(jScrollPane2)
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(28, 28, 28)
                .addComponent(jLabel1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel14)
                    .addComponent(txtTimDD, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(1, 1, 1)
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 164, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jLabel12)
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel7)
                    .addComponent(txtTendd, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel6)
                    .addComponent(cbMdd, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel8)
                    .addComponent(cbTp, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(26, 26, 26)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel9)
                    .addComponent(jScrollPane4, javax.swing.GroupLayout.PREFERRED_SIZE, 101, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(37, 37, 37)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnThemDD, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnXoaDD, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnSuaDD, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnLamMoi, javax.swing.GroupLayout.PREFERRED_SIZE, 40, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(207, 207, 207))
        );
    }// </editor-fold>//GEN-END:initComponents
    AutoCreateID autoID = new AutoCreateID();

//    void Test() {
//        int i = cbMdd.getSelectedIndex();
//        int j = cbTp.getSelectedIndex();
//        HashMap<Integer, Integer> test = new HashMap<Integer, Integer>();
//        test.put(i, j);
//
//    }
    void blockText(boolean isOK) {
        if (isOK == true) {
            cbMdd.setEnabled(false);
            cbTp.setEnabled(false);
        } else {
            cbMdd.setEnabled(true);
            cbTp.setEnabled(true);
        }
    }

    void Reset() {
        txtTendd.setText("");
        cbTp.setSelectedIndex(0);
        cbMdd.setSelectedIndex(0);
        txtMoTa.setText("");
        tblDiaDiem.setShowHorizontalLines(false);
    }
    private void btnThemDDActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnThemDDActionPerformed
        String tendd = txtTendd.getText();
        String zipcode = (String) cbMdd.getSelectedItem();
        String thanhpho = (String) cbTp.getSelectedItem();
        String mota = txtMoTa.getText();
        boolean isOK = true;
        if (tendd.length() == 0) {
            JOptionPane.showMessageDialog(this, "Tên địa điểm không để trống");
            isOK = false;
        } else if (mota.length() == 0) {
            JOptionPane.showMessageDialog(this, "Mô tả không để trống");
            isOK = false;
        }
        if (isOK) {
            DiaDiemDTO dd = new DiaDiemDTO(zipcode, tendd, thanhpho, mota);
            new DiaDiemBLL().addDiaDiem(dd);
            JOptionPane.showMessageDialog(this, "Thêm thành công ");
            Reset();
            showDiaDiem();
        } else {
            JOptionPane.showMessageDialog(this, "Thêm không thành công");
        }
    }//GEN-LAST:event_btnThemDDActionPerformed

    private void tblDiaDiemMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblDiaDiemMouseClicked
        // TODO add your handling code here:
        int index = tblDiaDiem.getSelectedRow();
        txtTendd.setText(dtm.getValueAt(index, 1).toString().trim());
        cbMdd.setSelectedItem(dtm.getValueAt(index, 0).toString().trim());
        cbTp.setSelectedItem(dtm.getValueAt(index, 2).toString().trim());
        txtMoTa.setText(dtm.getValueAt(index, 3).toString().trim());
        blockText(true);
    }//GEN-LAST:event_tblDiaDiemMouseClicked

    private void btnLamMoiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLamMoiActionPerformed
        // TODO add your handling code here:
        Reset();
        blockText(false);
    }//GEN-LAST:event_btnLamMoiActionPerformed

    private void btnXoaDDActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnXoaDDActionPerformed
        int index = tblDiaDiem.getSelectedRow();
        if (index == -1) {
            JOptionPane.showMessageDialog(this, "Vui lòng chọn dòng rồi xóa");
        } else {
            if (JOptionPane.showConfirmDialog(this, "Bạn có muốn xóa không") == 0) {
                new DiaDiemBLL().removeDiaDiem(dtm.getValueAt(index, 0).toString().trim());
                JOptionPane.showMessageDialog(this, "Xóa thành công");
                showDiaDiem();
            } else {
                JOptionPane.showMessageDialog(this, "Xóa không thành công");
            }
        }
    }//GEN-LAST:event_btnXoaDDActionPerformed

    private void btnSuaDDActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSuaDDActionPerformed
        int index = tblDiaDiem.getSelectedRow();
        if (index == -1) {
            JOptionPane.showMessageDialog(this, "Vui lòng chọn dòng để sửa");
        } else {
            if (JOptionPane.showConfirmDialog(this, "Bạn có chắc muốn sửa không") == 0) {
                DiaDiemDTO dd = new DiaDiemDTO(cbMdd.getSelectedItem().toString(), txtTendd.getText(), cbTp.getSelectedItem().toString(), txtMoTa.getText());
                new DiaDiemBLL().editDiaDiem(dd, dtm.getValueAt(index, 0).toString().trim());
                JOptionPane.showMessageDialog(this, "Sửa thành công");
                showDiaDiem();
            } else {
                JOptionPane.showMessageDialog(this, "Sửa không thành công");
            }
        }
    }//GEN-LAST:event_btnSuaDDActionPerformed

    private void cbMddActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbMddActionPerformed
        cbTp.setSelectedIndex(cbMdd.getSelectedIndex());

    }//GEN-LAST:event_cbMddActionPerformed

    private void cbTpActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbTpActionPerformed
        cbMdd.setSelectedIndex(cbTp.getSelectedIndex());
    }//GEN-LAST:event_cbTpActionPerformed
    public void showDiaDiem() {
        ArrayList<DiaDiemDTO> ddList = new DiaDiemBLL().loadDataDiaDiem();

        dtm.setRowCount(0);
        ddList.forEach((DiaDiemDTO) -> {
            dtm.addRow(new Object[]{DiaDiemDTO.getMadd(), DiaDiemDTO.getTendd(), DiaDiemDTO.getThanhpho(), DiaDiemDTO.getMota()});
        });
    }

    void TimKiem() {
        TableRowSorter<TableModel> rowSorter = new TableRowSorter<>(tblDiaDiem.getModel());
        tblDiaDiem.setRowSorter(rowSorter);
        txtTimDD.getDocument().addDocumentListener(new DocumentListener() {
            @Override
            public void insertUpdate(DocumentEvent de) {
                String text = txtTimDD.getText();
                if (text.trim().length() == 0) {
                    rowSorter.setRowFilter(null);
                } else {
                    rowSorter.setRowFilter(RowFilter.regexFilter("(?i)" + text));
                }
            }

            @Override
            public void removeUpdate(DocumentEvent de) {
                String text = txtTimDD.getText();
                if (text.length() == 0) {
                    rowSorter.setRowFilter(null);
                } else {
                    rowSorter.setRowFilter(RowFilter.regexFilter("(?i)" + text));
                }
            }

            @Override
            public void changedUpdate(DocumentEvent de) {
                throw new UnsupportedOperationException("Not supported yet."); //To change body of generated methods, choose Tools | Templates.
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnLamMoi;
    private javax.swing.JButton btnSuaDD;
    private javax.swing.JButton btnThemDD;
    private javax.swing.JButton btnXoaDD;
    private javax.swing.JComboBox<String> cbMdd;
    private javax.swing.JComboBox<String> cbTp;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JTable tblDiaDiem;
    private javax.swing.JTextPane txtMoTa;
    private javax.swing.JTextField txtTendd;
    private javax.swing.JTextField txtTimDD;
    // End of variables declaration//GEN-END:variables
}
